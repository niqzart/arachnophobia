<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:pf="http://primefaces.org/ui">
<body>
<ui:composition template="/views/template.xhtml">

  <ui:define name="title">Lab 3 | Main</ui:define>

  <ui:define name="scripts">
    <script src="/static/canvaser.js"></script>
    <script src="/static/validator.js"></script>
    <script>
      window.onload = () => {
        resizeResultTable()
        // fillCanvas("")
        pickX(#{mainBean.x})
      }
    </script>
  </ui:define>

  <ui:define name="content">
    <table id="content">
      <tbody>
      <tr>
        <td>
          <h:form class="form" >
            <fieldset>
              <span class="inputs" id="x-p">
                <label>
                  <span class="main-label">X:<br/></span>
                </label>
                <c:forEach var="x" begin="0" end="8">
                  <label>
                    <h:commandButton id="X#{x}"
                                     class="input x-button"
                                     value="#{x - 4}"
                    >
                      <f:setPropertyActionListener target="#{mainBean.x}"
                                                   value="#{x - 4}" />
                    </h:commandButton>
                    <ui:fragment rendered="#{x == 2 || x == 5}">
                      <br/>
                    </ui:fragment>
                  </label>
                </c:forEach>
              </span>
              <p id="y-p" class="form-part">
                <span class="main-label">Y:</span>
                <pf:inputText id="y-input"
                              type="text"
                              class="input text-input"
                              maxlength="8"
                              value="#{mainBean.y}"
                              widgetVar="y-input"
                >
                  <f:validateDoubleRange minimum="-5" maximum="5"/>
                </pf:inputText>
              </p>
              <p id="r-p" class="form-part">
                <span class="main-label">R:</span>
                <pf:spinner id="r-input"
                            class="input"
                            rotate="true"
                            stepFactor="0.1"
                            min="0.1"
                            max="3"
                            decimalSeparator="."
                            value="#{mainBean.r}"
                            widgetVar="r-input"
                >
                  <f:validateDoubleRange minimum="0.1" maximum="3"/>
                </pf:spinner>
              </p>
              <p class="form-part">
                <h:commandButton value="Submit"
                                 update="@form"
                                 action="#{mainBean.addFormPoint}"
                                 widgetVar="submitButton"
                >
                  <f:ajax execute="@form" render="results"/>
                </h:commandButton>
              </p>
              <p id="messages" style="visibility: hidden"/>
            </fieldset>
          </h:form>
        </td>
        <td>
          <h:form id="plot">
            <h:inputHidden id="x-canvas" value="#{mainBean.xc}">
            </h:inputHidden>
            <h:inputHidden id="y-canvas" value="#{mainBean.yc}">
            </h:inputHidden>
            <canvas id="point-area" onclick="onClickCanvas(#{mainBean.r})">

            </canvas>
            <pf:remoteCommand name="addPoint" action="#{mainBean.addCanvasPoint}" update=":results"/>
          </h:form>
        </td>
      </tr>
      <tr>
        <td colspan="2" id="result-wrapper">
          <div id="result-container">
            <h:dataTable value="#{mainBean.points}"
                         var="point"
                         id="results"
            >
              <h:column>
                <f:facet name="header">X</f:facet>
                <h:outputText value="#{point.x}">
                  <f:convertNumber pattern="###.####"/>
                </h:outputText>
              </h:column>
              <h:column>
                <f:facet name="header">Y</f:facet>
                <h:outputText value="#{point.y}">
                  <f:convertNumber pattern="###.####"/>
                </h:outputText>
              </h:column>
              <h:column>
                <f:facet name="header">R</f:facet>
                #{point.r}
              </h:column>
              <h:column>
                <f:facet name="header">Result</f:facet>
                #{point.inside}
              </h:column>
            </h:dataTable>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </ui:define>

</ui:composition>
</body>

</html>